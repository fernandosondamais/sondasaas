<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gestão - SondaMais</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root { --sonda-green: #6a9615; --sonda-dark: #444444; }
        body { background-color: #f8f9fa; }
        .navbar-sonda { background-color: var(--sonda-green); color: white; }
        .btn-outline-sonda { color: var(--sonda-green); border-color: var(--sonda-green); }
        .btn-outline-sonda:hover { background-color: var(--sonda-green); color: white; }
    </style>
</head>
<body>
    <nav class="navbar navbar-sonda mb-4 shadow-sm">
        <div class="container">
            <span class="navbar-brand"><i class="bi bi-building-gear me-2"></i>SondaSaaS Admin</span>
            <div class="d-flex gap-2">
                <a href="/boletim" target="_blank" class="btn btn-dark btn-sm"><i class="bi bi-cone-striped"></i> Sondador</a>
                <a href="/logout" class="btn btn-outline-light btn-sm">Sair</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="card shadow-sm mb-4 border-0">
            <div class="card-body"><input type="text" id="inputBusca" class="form-control" placeholder="Pesquisar..."></div>
        </div>
        <div class="card shadow-sm border-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" id="tabelaPropostas">
                    <thead class="table-light"><tr><th class="ps-4">ID</th><th>Cliente</th><th>Valor</th><th class="text-end pe-4">Ações</th></tr></thead>
                    <tbody class="bg-white"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        fetch('/api/propostas').then(r=>r.json()).then(d => {
            const tb = document.querySelector('tbody'); tb.innerHTML = '';
            d.forEach(p => {
                const valor = parseFloat(p.valor_total).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
                tb.innerHTML += `
                <tr>
                    <td class="ps-4 fw-bold text-muted">#${p.id}</td>
                    <td><div class="fw-bold">${p.cliente}</div><small class="text-muted">${p.endereco}</small></td>
                    <td class="fw-bold text-success">${valor}</td>
                    <td class="text-end pe-4">
                        <a href="/engenharia?id=${p.id}" class="btn btn-sm btn-outline-primary me-1" title="Ver Dados de Campo"><i class="bi bi-bricks"></i> Eng.</a>
                        <a href="/reemitir-pdf/${p.id}" target="_blank" class="btn btn-sm btn-outline-sonda me-1"><i class="bi bi-file-earmark-pdf"></i></a>
                        <button onclick="del(${p.id})" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`;
            });
        });
        function del(id) { if(confirm('Apagar?')) fetch('/api/propostas/'+id, {method:'DELETE'}).then(()=>location.reload()); }
    </script>
</body>
</html>