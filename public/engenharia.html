<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Engenharia | SondaSaaS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>body{background:#f4f5f7}</style>
</head>
<body>
    <div class="container py-4">
        <div class="d-flex justify-content-between mb-4">
            <h4 id="titulo">Carregando dados da obra...</h4>
            <a href="/admin" class="btn btn-secondary">Voltar ao Admin</a>
        </div>
        <div id="furos-container" class="row"></div>
    </div>
    <script>
        const id = new URLSearchParams(window.location.search).get('id');
        if(!id) {
            document.getElementById('titulo').innerText = 'Erro: ID da obra nÃ£o fornecido.';
        } else {
            fetch(`/api/engenharia/${id}`).then(r=>r.json()).then(d=>{
                document.getElementById('titulo').innerText = 'Obra: ' + d.proposta.cliente;
                const c = document.getElementById('furos-container');
                
                if(d.furos.length === 0) {
                     c.innerHTML = '<div class="alert alert-warning">Nenhum furo iniciado nesta obra ainda.</div>';
                     return;
                }

                d.furos.forEach(f => {
                    let html = `<div class="col-md-6 mb-3">
                        <div class="card p-3 shadow-sm">
                            <h5 class="border-bottom pb-2">${f.nome_furo} <span class="badge bg-secondary float-end" style="font-size:0.6em">${f.coordenadas || 'Sem GPS'}</span></h5>
                            <table class="table table-sm table-striped">
                                <thead><tr><th>Prof.</th><th>Golpes</th><th>Solo</th></tr></thead>
                                <tbody>`;
                    
                    f.amostras.forEach(a => { 
                        html += `<tr><td>${a.profundidade_ini}m</td><td>${a.golpe_1}-${a.golpe_2}-${a.golpe_3}</td><td>${a.tipo_solo}</td></tr>`; 
                    });
                    
                    html += `</tbody></table>`;
                    
                    if(f.fotos && f.fotos.length > 0) {
                        html += `<div class="mt-2 border-top pt-2"><small class="fw-bold">Fotos:</small><div class="d-flex gap-2 mt-1 overflow-auto">`;
                        f.fotos.forEach(ft => {
                            html += `<a href="/api/foto-full/${ft.id}" target="_blank"><img src="/api/foto-full/${ft.id}" height="50" class="rounded border"></a>`;
                        });
                        html += `</div></div>`;
                    }
                    
                    html += `</div></div>`;
                    c.innerHTML += html;
                });
            }).catch(err => {
                document.getElementById('titulo').innerText = 'Erro ao carregar dados.';
                console.error(err);
            });
        }
    </script>
</body>
</html>